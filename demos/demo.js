function ChaseDemo(){var cat;var dog;var rat;var mouse=new Vector;var center=new Vector;var renderer;return Sketch.create({container:document.getElementById("container"),retina:"auto",setup:function(){center.set(this.width/2,this.height/2);mouse.set(this.width/2,this.height/2);dog=new Agent({maxForce:.1,maxSpeed:2,radius:25});cat=new Agent({maxForce:.2,maxSpeed:3,radius:15});rat=new Agent({maxForce:1.2,maxSpeed:4,radius:8});var min=new Vector;var max=new Vector(this.width,this.height);var bounds=new Bounds({min:min,max:max,bounce:false});var wander=new Wander({radius:120,jitter:.5,weight:.8});var seekCenter=new Seek({target:center});var seekMouse=new Seek({target:mouse});var fleeDog=new Flee({target:dog,weight:.6});var fleeCat=new Flee({target:cat,weight:1});var huntCat=new Seek({target:cat,weight:.8});cat.behaviors.push(bounds,seekMouse,fleeDog);dog.behaviors.push(bounds,wander,huntCat);rat.behaviors.push(bounds,seekCenter,fleeCat);dog.set(300,300);cat.set(600,300);rat.set(this.width/2,this.height/2);renderer=new Renderer},update:function(){cat.update();dog.update();rat.update()},draw:function(){renderer.render(cat,this);renderer.render(dog,this);renderer.render(rat,this)},resize:function(){center.set(this.width/2,this.height/2)},mousemove:function(){mouse.set(this.mouse.x,this.mouse.y)}})}var gui;(function(){var demos={Seek:SeekDemo,Flee:FleeDemo,Flock:FlockDemo,Wander:WanderDemo};function changeDemo(){var i,n;for(i=gui.__controllers.length-1;i>=0;i--){try{gui.remove(gui.__controllers[i])}catch(error){}}for(i=0,n=Sketch.instances.length;i<n;i++){Sketch.instances[i].destroy()}}demos.Flock();var faded=document.querySelector(".faded");setTimeout(function(){faded.classList.remove("faded")},0)})();function FleeDemo(){var NUM_AGENTS=80;var COLOURS=["#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","#83AF9B","#FF4E50","#FC913A","#F9D423","#EDE574","#E1F5C4","#B3CC57","#ECF081","#FFBE40","#EF746F","#D0ECEA","#9FD6D2"];var renderer=new Renderer;var mouse=new Vector;var agents=[];return Sketch.create({container:document.getElementById("container"),retina:"auto",setup:function(){mouse.set(this.width*.5,this.height*.5);var seek=new Seek({target:mouse,weight:.2});var flee=new Flee({target:mouse,radius:200,weight:2});for(var i=0;i<NUM_AGENTS;i++){agents.push(new Agent({behaviors:[seek,flee],maxForce:random(.02,.5),maxSpeed:random(1,25),radius:random(8,32),color:random(COLOURS),x:random(this.width),y:random(this.height)}))}gui.add(flee,"radius").min(10).max(400).name("Flee Radius")},update:function(){for(var i=0;i<NUM_AGENTS;i++){agents[i].update()}},draw:function(){for(var i=0;i<NUM_AGENTS;i++){renderer.renderAgent(agents[i],this)}renderer.renderMouse(mouse,this)},mousemove:function(){mouse.set(this.mouse.x,this.mouse.y)}})}function FlockDemo(){var NUM_AGENTS=Math.round(Math.min(200,Math.max(20,Math.sqrt(Math.pow(window.innerWidth,2),Math.pow(window.innerHeight,2))/6)));var COLOURS=["#111111","#222222","#333333","#444444","#555555","#666666","#777777","#888888","#999999","#aaaaaa","#bbbbbb","#cccccc","#dddddd","#eeeeee","#FFFFFF","#000000"];var renderer=new Renderer;var agents=[];var mouse=new Vector;var bounds=new Bounds;var flee,align,cohere,separate;return Sketch.create({container:document.getElementById("container"),retina:"auto",setup:function(){mouse.set(this.width*.5,this.height*.5);flee=new Flee({target:mouse,radius:0,weight:2});align=new Align({radius:100,agents:agents,weight:.5,chance:.8});cohere=new Cohere({radius:100,agents:agents,weight:.01,chance:.5});separate=new Separate({radius:10,agents:agents,weight:2,chance:1});for(var i=0;i<NUM_AGENTS;i++){wander=new Wander({theta:random(-PI,PI),jitter:random(.05,.5),radius:random(10,60),weight:1e-4});agents.push(new Agent({behaviors:[bounds,flee,align,cohere,separate],maxForce:random(.2,.7),maxSpeed:random(2,25),radius:random(8,32),color:random(COLOURS),vel:new Vector(random(),random()),x:this.width*random(.4,.6),y:this.height*random(.49,.51)}))}if(gui){gui.add(align,"radius").min(50).max(1e3).name("Align Radius");gui.add(align,"weight").min(0).max(1).name("Align Weight");gui.add(cohere,"radius").min(50).max(1e3).name("Cohere Radius");gui.add(cohere,"weight").min(0).max(1).name("Cohere Weight");gui.add(separate,"radius").min(0).max(100).name("Avoid Radius");gui.add(separate,"weight").min(0).max(10).name("Avoid Weight")}},update:function(){flee.radius*=.99;flee.weight*=.99;for(var i=0;i<NUM_AGENTS;i++){agents[i].update()}},draw:function(){var t=this.millis;align.radius=map(sin(t*.00142),-1,1,50,200);align.weight=map(cos(t*38e-5),-1,1,.1,.8);cohere.radius=map(sin(t*48e-5),-1,1,50,200);cohere.weight=map(sin(t*9e-5),-1,1,.005,.02);separate.radius=map(sin(t*.0012),-1,1,8,25);separate.weight=map(cos(t*.0011),-1,1,1,3);for(var i=0;i<NUM_AGENTS;i++){renderer.renderAgent(agents[i],this)}},resize:function(){bounds.max.set(this.width,this.height)},mousemove:function(){mouse.set(this.mouse.x,this.mouse.y);flee.radius=400;flee.weight=10}})}function Renderer(options){this.options=options;function line(x1,y1,x2,y2,ctx){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.closePath()}function arrow(size,ctx){ctx.beginPath();ctx.moveTo(-size,-size);ctx.lineTo(size,0);ctx.lineTo(-size,size);ctx.closePath()}this.renderAgent=function(agent,ctx){var mag=agent.vel.mag()*6;var rad=agent.vel.angle();ctx.save();ctx.globalAlpha=.8;ctx.beginPath();ctx.arc(agent.x,agent.y,agent.radius,0,Math.PI*2);ctx.closePath();ctx.fillStyle=agent.color||"#00FFFF";ctx.fill();ctx.restore();ctx.save();ctx.globalAlpha=.6;ctx.translate(agent.x,agent.y);ctx.rotate(rad);line(0,0,mag,0,ctx);ctx.strokeStyle=agent.color||"#00FFFF";ctx.lineWidth=2;ctx.lineCap="round";ctx.stroke();ctx.translate(mag,0);arrow(Math.max(4,agent.radius*.25),ctx);ctx.fillStyle=agent.color||"#00FFFF";ctx.fill();ctx.restore()};this.renderObstacle=function(obstacle,ctx){ctx.save();ctx.globalAlpha=.8;ctx.beginPath();ctx.arc(obstacle.x,obstacle.y,obstacle.radius,0,Math.PI*2);ctx.closePath();ctx.fillStyle=obstacle.color||"#000000";ctx.fill();ctx.restore()};this.renderMouse=function(mouse,ctx){ctx.save();ctx.globalAlpha=.8;ctx.beginPath();ctx.arc(mouse.x,mouse.y,50,0,Math.PI*2);ctx.closePath();ctx.fillStyle="rgba(0,0,0,0.05)";ctx.fill();ctx.restore()};this.renderWander=function(agent,ctx){var behavior;for(var i=0,n=agent.behaviors.length;i<n;i++){behavior=agent.behaviors[i];if(behavior instanceof Wander){ctx.save();var offset=agent.vel.clone();offset.norm();offset.scale(behavior.distance);offset.add(agent);ctx.translate(offset.x,offset.y);ctx.beginPath();ctx.arc(0,0,behavior.radius,0,Math.PI*2);ctx.closePath();ctx.globalAlpha=.28;ctx.fillStyle=agent.color;ctx.fill();ctx.save();ctx.globalAlpha=.85;ctx.strokeStyle=agent.color;ctx.rotate(behavior.theta);line(0,0,0,behavior.radius-8,ctx);ctx.stroke();ctx.beginPath();ctx.arc(0,behavior.radius,8,0,Math.PI*2);ctx.closePath();ctx.stroke();ctx.restore();ctx.restore()}}};this.renderAvoid=function(agent,ctx){var behavior;for(var i=0,n=agent.behaviors.length;i<n;i++){behavior=agent.behaviors[i];if(behavior instanceof Avoid){ctx.save();ctx.translate(agent.x,agent.y);var forward=agent.vel.clone().norm().scale(behavior.radius+agent.radius);line(0,0,forward.x,forward.y,ctx);ctx.strokeStyle=agent.color;ctx.stroke();ctx.restore()}}}}function SeekDemo(){var NUM_AGENTS=60;var COLOURS=["#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","#83AF9B","#FF4E50","#FC913A","#F9D423","#EDE574","#E1F5C4","#B3CC57","#ECF081","#FFBE40","#EF746F","#D0ECEA","#9FD6D2"];var renderer=new Renderer;var agents=[];var mouse=new Vector;var bounds=new Bounds;return Sketch.create({container:document.getElementById("container"),retina:"auto",setup:function(){mouse.set(this.width*.5,this.height*.5);var seek=new Seek({braking:100,radius:500,target:mouse});for(var i=0;i<NUM_AGENTS;i++){agents.push(new Agent({behaviors:[bounds,seek],maxForce:random(.02,.5),maxSpeed:random(1,25),radius:random(8,32),color:random(COLOURS),x:random(this.width),y:random(this.height)}))}gui.add(seek,"radius").min(50).max(1e3).name("Seek Radius");gui.add(seek,"braking").min(10).max(400).name("Braking Radius")},update:function(){for(var i=0;i<NUM_AGENTS;i++){agents[i].update()}},draw:function(){for(var i=0;i<NUM_AGENTS;i++){renderer.renderAgent(agents[i],this)}renderer.renderMouse(mouse,this)},resize:function(){bounds.max.set(this.width,this.height)},mousemove:function(){mouse.set(this.mouse.x,this.mouse.y)}})}function WanderDemo(){var NUM_AGENTS=10;var COLOURS=["#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","#83AF9B","#FF4E50","#FC913A","#F9D423","#EDE574","#E1F5C4","#B3CC57","#ECF081","#FFBE40","#EF746F","#D0ECEA","#9FD6D2"];var renderer=new Renderer;var options={swarm:true};var agents=[];var bounds=new Bounds;return Sketch.create({container:document.getElementById("container"),retina:"auto",setup:function(){var agent,wander,seek;for(var i=0;i<NUM_AGENTS;i++){wander=new Wander({distance:100,jitter:random(.05,.25),radius:50,weight:random(.5,2),theta:random(-PI,PI)});agent=new Agent({behaviors:[bounds,wander],maxForce:1,maxSpeed:random(1,6),radius:random(8,32),color:random(COLOURS),vel:new Vector(2,2),x:random(this.width),y:random(this.height)});if(i>0){seek=new Seek({enabled:false,target:agents[i-1],weight:random(.5,2.5)});agent.behaviors.push(seek);agent.seek=seek}agents.push(agent)}gui.add(options,"swarm").onChange(function(){for(var i=0;i<NUM_AGENTS;i++){agent=agents[i];if(agent.seek)agent.seek.enabled=options.swarm}}).name("Swarm")},update:function(){for(var i=0;i<NUM_AGENTS;i++){agents[i].update()}},draw:function(){var agent;for(var i=0;i<NUM_AGENTS;i++){agent=agents[i];renderer.renderAgent(agent,this);renderer.renderWander(agent,this)}},resize:function(){bounds.max.set(this.width,this.height)}})}
